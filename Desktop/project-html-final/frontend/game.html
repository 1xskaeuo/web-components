<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game - –ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Memory Game</h1>
            <nav>
                <button id="theme-toggle">üåô</button>
                <button onclick="location.href='index.html'">üè† –ì–ª–∞–≤–Ω–∞—è</button>
                <button onclick="location.href='profile.html'">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
                <button id="logout-btn">üö™ –í—ã–π—Ç–∏</button>
            </nav>
        </header>

        <div class="game-info">
            <div class="score">–°—á–µ—Ç: <span id="score">0</span></div>
            <div class="timer">–í—Ä–µ–º—è: <span id="timer">0</span>—Å</div>
            <div class="level">–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
            <button id="restart">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        <div id="game-board" class="game-board"></div>
        
        <div id="auth-required" style="display: none; text-align: center; padding: 40px;">
            <h2>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <p>–î–ª—è –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</p>
            <button onclick="location.href='login.html'" class="btn-primary">–í–æ–π—Ç–∏</button>
            <button onclick="location.href='register.html'" class="btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–≥—Ä—ã...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
            initTheme();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            checkGameAuth();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            initEventHandlers();
        });

        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            
            if (!themeToggle) {
                console.error('–ö–Ω–æ–ø–∫–∞ —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                return;
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
            const savedTheme = localStorage.getItem('theme') || 'light';
            body.setAttribute('data-theme', savedTheme);
            themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            console.log('–¢–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:', savedTheme);
        }

        function initEventHandlers() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —Ç–µ–º—ã –≤ –∏–≥—Ä–µ');
                    const body = document.body;
                    const currentTheme = body.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    body.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    this.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    
                    console.log('–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞:', newTheme);
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    localStorage.removeItem('token');
                    window.location.href = 'index.html';
                });
            }
        }

        async function checkGameAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                showAuthRequired();
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    localStorage.removeItem('token');
                    showAuthRequired();
                    return;
                }
                
                // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
                console.log('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
                startGame();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showAuthRequired();
            }
        }

        function showAuthRequired() {
            document.querySelector('.game-info').style.display = 'none';
            document.getElementById('game-board').style.display = 'none';
            document.getElementById('auth-required').style.display = 'block';
        }

        function startGame() {
            document.querySelector('.game-info').style.display = 'flex';
            document.getElementById('game-board').style.display = 'grid';
            document.getElementById('auth-required').style.display = 'none';
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            window.game = new MemoryGame();
        }
    </script>
</body>
</html>